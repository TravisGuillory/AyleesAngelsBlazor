@using AyleesAngels.Shared.Models;
@using AyleesAngels.Shared.Utils;

@*@inject HttpClient Http*@
@inject IHttpClientFactory ClientFactory


@page "/"

<div class="hero">
    <Jumbotron  />
</div>
    

<div class="container">
    <AAHeader Heading="Latest News" SubHeading="Recent Posts" ></AAHeader>
    <div class="row text-center">
        <div class="col-lg-8 col-md-10 mx-auto ">
            @foreach (var post in blogPosts)
            {
                <BlogPostPreview BlogPost=@post></BlogPostPreview>
                <hr />
                
            }
            
        </div>
    </div>
</div>



@code {



    protected List<BlogPost> blogPosts { get; set; } = new List<BlogPost>();
   

    protected override async Task OnInitializedAsync()
    {

        await LoadBlogPosts();
    }

    private async Task LoadBlogPosts()
    {
        try
        {
            var blogPostsResponse = await ClientFactory.CreateClient("AyleesAngels.ServerAPI.Guest")
                .GetFromJsonAsync<ServiceResponse<List<BlogPost>>>(Urls.BlogPosts);
            //blogPosts = blogPostsResponse.OrderByDescending(p => p.Posted).ToList();
            blogPosts = blogPostsResponse.Data.OrderByDescending(p => p.Posted).ToList();

            

        }
        catch (Exception ex)
        {
            Console.WriteLine(ex);
        }

    }

}